<!--matchTable.wxml-->
<view class="match-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-icon">ğŸ¸</view>
    <view class="header-title">æ¯”èµ›å¯¹é˜µè¡¨</view>
    <view class="header-subtitle">ç¾½æ¯›çƒèµ›ç¨‹å®‰æ’</view>
    <view class="header-actions">
      <button class="action-btn clear-all-btn" bindtap="onClearAllMatches">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
    </view>
  </view>

  <!-- æ¯”èµ›ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-cards">
    <view class="stat-card">
      <view class="stat-number">{{schedule.length}}</view>
      <view class="stat-label">è½®æ¬¡</view>
    </view>
    <view class="stat-card">
      <view class="stat-number">{{totalMatches}}</view>
      <view class="stat-label">æ€»åœºæ¬¡</view>
    </view>
    <view class="stat-card completed">
      <view class="stat-number">{{completedMatches}}</view>
      <view class="stat-label">å·²å®Œæˆ</view>
    </view>
    <view class="stat-card progress">
      <view class="stat-number">{{Math.round(completedMatches / totalMatches * 100)}}%</view>
      <view class="stat-label">è¿›åº¦</view>
    </view>
  </view>
  <!-- æ¯”èµ›è½®æ¬¡åˆ—è¡¨ -->
  <view class="rounds-section">
    <view wx:for="{{schedule}}" wx:for-index="roundIndex" wx:for-item="round" wx:key="round" class="round-container">
      
      <!-- è½®æ¬¡æ ‡é¢˜ -->
      <view class="round-header">
        <view class="round-icon">âš¡</view>
        <view class="round-title">ç¬¬ {{roundIndex + 1}} è½®</view>
        <view class="round-matches">{{round.length}} åœºæ¯”èµ›</view>
      </view>

      <!-- è¯¥è½®æ¬¡çš„æ¯”èµ›åˆ—è¡¨ -->
      <view class="matches-list">
        <view wx:for="{{round}}" wx:for-index="courtIndex" wx:for-item="match" wx:key="court" class="match-card {{isMatchFinished(roundIndex, courtIndex) ? 'finished' : ''}}">
          
          <!-- æ¯”èµ›ä¿¡æ¯å¤´éƒ¨ -->
          <view class="match-header">
            <view class="court-info">
              <view class="court-icon">ğŸŸï¸</view>
              <view class="court-name">åœºåœ° {{courtIndex + 1}}</view>
            </view>
            <view class="match-status {{getMatchStatus(roundIndex, courtIndex)}}">
              {{getMatchStatusText(roundIndex, courtIndex)}}
            </view>
          </view>

          <!-- å¯¹é˜µåŒæ–¹ -->
          <view class="teams-container">
            <!-- å·¦ä¾§é˜Ÿä¼ -->
            <view class="team left-team">
              <view class="team-label">Aé˜Ÿ</view>
              <view class="players">
                <view class="player {{getPlayerGenderClass(match[0])}}">
                  <view class="player-icon">{{getPlayerIcon(match[0])}}</view>
                  <view class="player-name">{{match[0]}}</view>
                </view>
                <view class="player {{getPlayerGenderClass(match[1])}}">
                  <view class="player-icon">{{getPlayerIcon(match[1])}}</view>
                  <view class="player-name">{{match[1]}}</view>
                </view>
              </view>
            </view>

            <!-- VS åˆ†éš”ç¬¦ -->
            <view class="vs-section">
              <view class="vs-icon">âš”ï¸</view>
              <view class="vs-text">VS</view>
            </view>

            <!-- å³ä¾§é˜Ÿä¼ -->
            <view class="team right-team">
              <view class="team-label">Bé˜Ÿ</view>
              <view class="players">
                <view class="player {{getPlayerGenderClass(match[2])}}">
                  <view class="player-icon">{{getPlayerIcon(match[2])}}</view>
                  <view class="player-name">{{match[2]}}</view>
                </view>
                <view class="player {{getPlayerGenderClass(match[3])}}">
                  <view class="player-icon">{{getPlayerIcon(match[3])}}</view>
                  <view class="player-name">{{match[3]}}</view>
                </view>
              </view>
            </view>
          </view>

          <!-- æ¯”åˆ†åŒºåŸŸ -->
          <view class="score-section">
            <view class="score-container">
              <!-- å·¦é˜Ÿæ¯”åˆ† -->
              <view class="score-input-group">
                <picker mode="selector" 
                        range="{{scoreRange}}" 
                        value="{{scoreRange.indexOf(scores[roundIndex][courtIndex].left)}}" 
                        data-round="{{roundIndex}}" 
                        data-court="{{courtIndex}}" 
                        data-side="left" 
                        bindchange="pickerScore"
                        disabled="{{isMatchFinished(roundIndex, courtIndex)}}"
                        class="score-picker {{isMatchFinished(roundIndex, courtIndex) ? 'disabled' : ''}}">
                  <view class="score-display {{getScoreDisplayClass(roundIndex, courtIndex, 'left')}}">
                    {{scores[roundIndex][courtIndex].left}}
                  </view>
                </picker>
              </view>

              <!-- æ¯”åˆ†åˆ†éš”ç¬¦ -->
              <view class="score-separator">:</view>

              <!-- å³é˜Ÿæ¯”åˆ† -->
              <view class="score-input-group">
                <picker mode="selector" 
                        range="{{scoreRange}}" 
                        value="{{scoreRange.indexOf(scores[roundIndex][courtIndex].right)}}" 
                        data-round="{{roundIndex}}" 
                        data-court="{{courtIndex}}" 
                        data-side="right" 
                        bindchange="pickerScore"
                        disabled="{{isMatchFinished(roundIndex, courtIndex)}}"
                        class="score-picker {{isMatchFinished(roundIndex, courtIndex) ? 'disabled' : ''}}">
                  <view class="score-display {{getScoreDisplayClass(roundIndex, courtIndex, 'right')}}">
                    {{scores[roundIndex][courtIndex].right}}
                  </view>
                </picker>
              </view>
            </view>

            <!-- æ¯”èµ›æ§åˆ¶æŒ‰é’® -->
            <view class="match-controls">
              <button class="control-btn {{isMatchFinished(roundIndex, courtIndex) ? 'finished-btn' : 'finish-btn'}}" 
                      data-round="{{roundIndex}}" 
                      data-court="{{courtIndex}}" 
                      bindtap="{{isMatchFinished(roundIndex, courtIndex) ? 'resetMatch' : 'finishMatch'}}">
                {{isMatchFinished(roundIndex, courtIndex) ? 'é‡æ–°å¼€å§‹' : 'å®Œæˆæ¯”èµ›'}}
              </button>
            </view>

            <!-- æ¯”èµ›ç»“æœ -->
            <view wx:if="{{isMatchFinished(roundIndex, courtIndex)}}" class="match-result">
              ğŸ† {{getWinnerText(roundIndex, courtIndex)}}
              <view class="match-duration" wx:if="{{getMatchDuration(roundIndex, courtIndex)}}">
                ç”¨æ—¶: {{getMatchDuration(roundIndex, courtIndex)}}
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>

